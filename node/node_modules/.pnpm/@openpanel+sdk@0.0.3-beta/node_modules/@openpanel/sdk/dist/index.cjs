"use strict";var a=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var P=(r,e)=>{for(var t in e)a(r,t,{get:e[t],enumerable:!0})},y=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of v(e))!m.call(r,i)&&i!==t&&a(r,i,{get:()=>e[i],enumerable:!(n=I(e,i))||n.enumerable});return r};var O=r=>y(a({},"__esModule",{value:!0}),r);var D={};P(D,{OpenpanelSdk:()=>l});module.exports=O(D);function b(r){return Promise.all(Object.entries(r).map(async([e,t])=>[e,await t??""])).then(e=>Object.fromEntries(e))}function R(r){let e={"Content-Type":"application/json"};return{headers:e,async fetch(t,n,i){let g=`${r}${t}`,d,h=await b(e);return new Promise(p=>{let c=s=>{clearTimeout(d),fetch(g,{headers:h,method:"POST",body:JSON.stringify(n??{}),keepalive:!0,...i??{}}).then(async o=>{if(o.status===401)return null;if(o.status!==200&&o.status!==202)return f(s,p);let u=await o.text();if(!u)return p(null);p(u)}).catch(()=>f(s,p))};function f(s,o){if(s>1)return o(null);d=setTimeout(()=>{c(s+1)},Math.pow(2,s)*500)}c(0)})}}}var l=class{constructor(e){this.state={properties:{}};this.options=e,this.api=R(e.url??"https://api.openpanel.dev"),this.api.headers["openpanel-client-id"]=e.clientId,this.options.clientSecret&&(this.api.headers["openpanel-client-secret"]=this.options.clientSecret)}setProfileId(e){this.state.profileId=e}setProfile(e){this.setProfileId(e.profileId),this.api.fetch("/profile",{...e,properties:{...this.state.properties,...e.properties}})}increment(e,t,n){let i=n?.profileId??this.state.profileId;if(!i)return console.log("No profile id");this.api.fetch("/profile/increment",{profileId:i,property:e,value:t})}decrement(e,t,n){let i=n?.profileId??this.state.profileId;if(!i)return console.log("No profile id");this.api.fetch("/profile/decrement",{profileId:i,property:e,value:t})}event(e,t){let n=t?.profileId??this.state.profileId;delete t?.profileId,this.api.fetch("/event",{name:e,properties:{...this.state.properties,...t??{}},timestamp:this.timestamp(),deviceId:this.getDeviceId(),profileId:n}).then(i=>{this.options.setDeviceId&&i&&this.options.setDeviceId(i)})}setGlobalProperties(e){this.state.properties={...this.state.properties,...e}}clear(){this.state.deviceId=void 0,this.state.profileId=void 0,this.options.removeDeviceId&&this.options.removeDeviceId()}timestamp(){return new Date().toISOString()}getDeviceId(){if(this.state.deviceId)return this.state.deviceId;this.options.getDeviceId&&(this.state.deviceId=this.options.getDeviceId()||void 0)}};0&&(module.exports={OpenpanelSdk});
//# sourceMappingURL=index.cjs.map