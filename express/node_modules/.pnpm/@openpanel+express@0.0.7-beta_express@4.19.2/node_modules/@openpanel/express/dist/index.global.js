"use strict";(()=>{var R=Object.create;var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var M=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of T(t))!$.call(e,o)&&o!==i&&g(e,o,{get:()=>t[o],enumerable:!(n=N(t,o))||n.enumerable});return e};var X=(e,t,i)=>(i=e!=null?R(E(e)):{},M(t||!e||!e.__esModule?g(i,"default",{value:e,enumerable:!0}):i,e));var P=v((K,k)=>{"use strict";var b={ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i};function l(e){return function(){return!e.apply(null,Array.prototype.slice.call(arguments))}}function u(e){return e!=null}function w(e){return u(e)&&b.ipv4.test(e)||b.ipv6.test(e)}function O(e){return Object(e)===e}function S(e){return Object.prototype.toString.call(e)==="[object String]"}var G={existy:u,ip:w,object:O,string:S,not:{existy:l(u),ip:l(w),object:l(O),string:l(S)}};k.exports=G});var j=v((L,C)=>{"use strict";function h(e){"@babel/helpers - typeof";return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(e)}var r=P();function A(e){if(!r.existy(e))return null;if(r.not.string(e))throw new TypeError('Expected a string, got "'.concat(h(e),'"'));for(var t=e.split(",").map(function(n){var o=n.trim();if(o.includes(":")){var s=o.split(":");if(s.length===2)return s[0]}return o}),i=0;i<t.length;i++)if(r.ip(t[i]))return t[i];return null}function m(e){if(e.headers){if(r.ip(e.headers["x-client-ip"]))return e.headers["x-client-ip"];var t=A(e.headers["x-forwarded-for"]);if(r.ip(t))return t;if(r.ip(e.headers["cf-connecting-ip"]))return e.headers["cf-connecting-ip"];if(r.ip(e.headers["fastly-client-ip"]))return e.headers["fastly-client-ip"];if(r.ip(e.headers["true-client-ip"]))return e.headers["true-client-ip"];if(r.ip(e.headers["x-real-ip"]))return e.headers["x-real-ip"];if(r.ip(e.headers["x-cluster-client-ip"]))return e.headers["x-cluster-client-ip"];if(r.ip(e.headers["x-forwarded"]))return e.headers["x-forwarded"];if(r.ip(e.headers["forwarded-for"]))return e.headers["forwarded-for"];if(r.ip(e.headers.forwarded))return e.headers.forwarded;if(r.ip(e.headers["x-appengine-user-ip"]))return e.headers["x-appengine-user-ip"]}if(r.existy(e.connection)){if(r.ip(e.connection.remoteAddress))return e.connection.remoteAddress;if(r.existy(e.connection.socket)&&r.ip(e.connection.socket.remoteAddress))return e.connection.socket.remoteAddress}return r.existy(e.socket)&&r.ip(e.socket.remoteAddress)?e.socket.remoteAddress:r.existy(e.info)&&r.ip(e.info.remoteAddress)?e.info.remoteAddress:r.existy(e.requestContext)&&r.existy(e.requestContext.identity)&&r.ip(e.requestContext.identity.sourceIp)?e.requestContext.identity.sourceIp:e.headers&&r.ip(e.headers["Cf-Pseudo-IPv4"])?e.headers["Cf-Pseudo-IPv4"]:r.existy(e.raw)?m(e.raw):null}function J(e){var t=r.not.existy(e)?{}:e;if(r.not.object(t))throw new TypeError("Options must be an object!");var i=t.attributeName||"clientIp";return function(n,o,s){var p=m(n);Object.defineProperty(n,i,{get:function(){return p},configurable:!0}),s()}}C.exports={getClientIpFromXForwardedFor:A,getClientIp:m,mw:J}});var F=X(j(),1);function _(e){return Promise.all(Object.entries(e).map(async([t,i])=>[t,await i??""])).then(t=>Object.fromEntries(t))}function z(e){let t={"Content-Type":"application/json"};return{headers:t,async fetch(i,n,o){let s=`${e}${i}`,p,c=await _(t);return new Promise(f=>{let y=d=>{clearTimeout(p),fetch(s,{headers:c,method:"POST",body:JSON.stringify(n??{}),keepalive:!0,...o??{}}).then(async a=>{if(a.status===401)return null;if(a.status!==200&&a.status!==202)return I(d,f);let x=await a.text();if(!x)return f(null);f(x)}).catch(()=>I(d,f))};function I(d,a){if(d>1)return a(null);p=setTimeout(()=>{y(d+1)},Math.pow(2,d)*500)}y(0)})}}}var D=class{constructor(e){this.state={properties:{}},this.options=e,this.api=z(e.url??"https://api.openpanel.dev"),this.api.headers["openpanel-client-id"]=e.clientId,this.options.clientSecret&&(this.api.headers["openpanel-client-secret"]=this.options.clientSecret)}setProfileId(e){this.state.profileId=e}setProfile(e){this.setProfileId(e.profileId),this.api.fetch("/profile",{...e,properties:{...this.state.properties,...e.properties}})}increment(e,t,i){let n=i?.profileId??this.state.profileId;if(!n)return console.log("No profile id");this.api.fetch("/profile/increment",{profileId:n,property:e,value:t})}decrement(e,t,i){let n=i?.profileId??this.state.profileId;if(!n)return console.log("No profile id");this.api.fetch("/profile/decrement",{profileId:n,property:e,value:t})}event(e,t){let i=t?.profileId??this.state.profileId;delete t?.profileId,this.api.fetch("/event",{name:e,properties:{...this.state.properties,...t??{}},timestamp:this.timestamp(),deviceId:this.getDeviceId(),profileId:i}).then(n=>{this.options.setDeviceId&&n&&this.options.setDeviceId(n)})}setGlobalProperties(e){this.state.properties={...this.state.properties,...e}}clear(){this.state.deviceId=void 0,this.state.profileId=void 0,this.options.removeDeviceId&&this.options.removeDeviceId()}timestamp(){return new Date().toISOString()}getDeviceId(){if(this.state.deviceId)return this.state.deviceId;this.options.getDeviceId&&(this.state.deviceId=this.options.getDeviceId()||void 0)}};function B(e){return function(i,n,o){let s=new D(e),p=(0,F.getClientIp)(i);if(p&&(s.api.headers["x-forwarded-for"]=p),e.getProfileId){let c=e.getProfileId(i);c&&s.setProfileId(c)}return e.trackRequest?.(i.url)&&s.event("request",{url:i.url,method:i.method,query:i.query}),i.op=s,o()}}})();
//# sourceMappingURL=index.global.js.map