function h(o){return Promise.all(Object.entries(o).map(async([e,t])=>[e,await t??""])).then(e=>Object.fromEntries(e))}function I(o){let e={"Content-Type":"application/json"};return{headers:e,async fetch(t,r,i){let u=`${o}${t}`,a,g=await h(e);return new Promise(p=>{let l=n=>{clearTimeout(a),fetch(u,{headers:g,method:"POST",body:JSON.stringify(r??{}),keepalive:!0,...i??{}}).then(async s=>{if(s.status===401)return null;if(s.status!==200&&s.status!==202)return d(n,p);let c=await s.text();if(!c)return p(null);p(c)}).catch(()=>d(n,p))};function d(n,s){if(n>1)return s(null);a=setTimeout(()=>{l(n+1)},Math.pow(2,n)*500)}l(0)})}}}var f=class{constructor(e){this.state={properties:{}};this.options=e,this.api=I(e.url??"https://api.openpanel.dev"),this.api.headers["openpanel-client-id"]=e.clientId,this.options.clientSecret&&(this.api.headers["openpanel-client-secret"]=this.options.clientSecret)}setProfileId(e){this.state.profileId=e}setProfile(e){this.setProfileId(e.profileId),this.api.fetch("/profile",{...e,properties:{...this.state.properties,...e.properties}})}increment(e,t,r){let i=r?.profileId??this.state.profileId;if(!i)return console.log("No profile id");this.api.fetch("/profile/increment",{profileId:i,property:e,value:t})}decrement(e,t,r){let i=r?.profileId??this.state.profileId;if(!i)return console.log("No profile id");this.api.fetch("/profile/decrement",{profileId:i,property:e,value:t})}event(e,t){let r=t?.profileId??this.state.profileId;delete t?.profileId,this.api.fetch("/event",{name:e,properties:{...this.state.properties,...t??{}},timestamp:this.timestamp(),deviceId:this.getDeviceId(),profileId:r}).then(i=>{this.options.setDeviceId&&i&&this.options.setDeviceId(i)})}setGlobalProperties(e){this.state.properties={...this.state.properties,...e}}clear(){this.state.deviceId=void 0,this.state.profileId=void 0,this.options.removeDeviceId&&this.options.removeDeviceId()}timestamp(){return new Date().toISOString()}getDeviceId(){if(this.state.deviceId)return this.state.deviceId;this.options.getDeviceId&&(this.state.deviceId=this.options.getDeviceId()||void 0)}};export{f as OpenpanelSdk};
//# sourceMappingURL=index.js.map